<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>standard_errors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8fd1faf6fd93e4e6d207ae0f9db51d78.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
</div>
<section id="standard-errors-sample-size-and-statistical-significance" class="level1">
<h1>Standard errors, sample size, and statistical significance</h1>
<div class="notes">
<ul>
<li>The goal of experimental design is not to attain some level of statistical significance with high probability</li>
<li>The purpose of experimental design is to ensure we have a sense, <strong>before and after data have been collected</strong>, of what can realistically be learned from the experiment</li>
</ul>
</div>
<section id="standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="standard-errors">Standard errors</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We cannot make an infinite number of measurements of <span class="math inline">\(z\)</span>. We can only <em>take a <strong>sample</strong></em>.</p>
<p>The mean and standard deviation we <em>estimate</em> in an experiment <strong>will not match</strong> those of the infinitely large population.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Standard Error (of the Mean)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Standard Error (of the Mean)
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <em>standard error of the mean</em> reflects the uncertainty in our estimate of the mean.</p>
<p>When estimating the <strong>mean</strong> of an infinite population, given a simple random sample of size <span class="math inline">\(n\)</span>, the standard error is:</p>
<p><span class="math display">\[ \textrm{standard error} = \sqrt{\frac{\textrm{Variance}}{n}} = \frac{\textrm{standard deviation}}{\sqrt{n}} = \frac{\sigma}{\sqrt{n}} \]</span></p>
</div>
</div>
<div class="notes">
<ul>
<li><p>When we perform an experiment we measure a limited number of values</p></li>
<li><p>For statistical analysis, we consider that these values are randomly drawn from a random distribution containing an <em>infinite number of values</em></p></li>
<li><p>The mean, standard deviation, and other values we measure in our experiment <strong>will not match</strong> the true mean, standard deviation, or whatever of the full infinite distribution</p></li>
<li><p>We can, though, estimate our confidence in our estimate of the mean by the <em>standard error of the mean</em>, which reflects the uncertainty in our estimate of the true mean of the infinite distribution.</p>
<ul>
<li>The standard error is the square root of the variance divided by the size of the sample</li>
<li>This assumes that our sample is <strong>randomly selected from the population and all samples are independent</strong> - the more you violate those assumptions, the less accurate this estimate is</li>
<li>Since standard deviation is the square root of the variance, we can write this as:</li>
</ul></li>
<li><p>The standard error of the mean is the standard deviation divided by the square root of sample size</p></li>
</ul>
</div>
</section>
<section id="standard-error-and-sample-size" class="level2">
<h2 class="anchored" data-anchor-id="standard-error-and-sample-size">Standard error and sample size</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Uncertainty in the mean estimate <span class="math inline">\(\mu\)</span> reduces proportionally to the square root of the number of samples, <span class="math inline">\(n\)</span></p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots assuming mu = 0, sd = 1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># So the progressive standard errors are:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (n=3, sd=1/3), (n=5, sd=1/5), (n=7, sd=1/7), (n=10, sd=1/10), (n=20, sd=1/20)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shaded_normal</span>(<span class="at">mu=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">3</span>), <span class="at">zstart=</span><span class="dv">0</span>, <span class="at">zend=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"mu=0, sd=1, n=3"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">textyoffset =</span> <span class="dv">1</span>, <span class="at">fill=</span><span class="st">"gold"</span>, <span class="at">color=</span><span class="st">"gold4"</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shaded_normal</span>(<span class="at">mu=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>), <span class="at">zstart=</span><span class="dv">0</span>, <span class="at">zend=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"mu=0, sd=1, n=5"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">textyoffset =</span> <span class="dv">1</span>, <span class="at">fill=</span><span class="st">"coral"</span>, <span class="at">color=</span><span class="st">"coral4"</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shaded_normal</span>(<span class="at">mu=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">7</span>), <span class="at">zstart=</span><span class="dv">0</span>, <span class="at">zend=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"mu=0, sd=1, n=7"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">textyoffset =</span> <span class="dv">1</span>, <span class="at">fill=</span><span class="st">"lightskyblue"</span>, <span class="at">color=</span><span class="st">"lightskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shaded_normal</span>(<span class="at">mu=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">10</span>), <span class="at">zstart=</span><span class="dv">0</span>, <span class="at">zend=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"mu=0, sd=1, n=10"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">textyoffset =</span> <span class="dv">1</span>, <span class="at">fill=</span><span class="st">"palegreen"</span>, <span class="at">color=</span><span class="st">"palegreen4"</span>) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shaded_normal</span>(<span class="at">mu=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">20</span>), <span class="at">zstart=</span><span class="dv">0</span>, <span class="at">zend=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"mu=0, sd=1, n=20"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">textyoffset =</span> <span class="dv">1</span>, <span class="at">fill=</span><span class="st">"mediumpurple"</span>, <span class="at">color=</span><span class="st">"mediumpurple4"</span>) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"uncertainty in the mean estimate"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"density"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06-standard_errors_files/figure-html/stderr-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<ul>
<li><p>To visualise this, we can plot the distribution of our uncertainty in the estimate of the mean, where we’ve estimated that the mean is zero and the standard deviation is one, for a range of sample sizes, n</p></li>
<li><p>At <span class="math inline">\(n=3\)</span>, the uncertainty in our estimate is quite flat and broad</p></li>
<li><p>As we increase the number of samples <span class="math inline">\(n\)</span>, the uncertainty narrows, and the density of the distribution of estimates starts to gather more around the central value of our estimate of the mean.</p></li>
<li><p>This property holds regardless of our assumptions about the shape of the sampling distribution</p>
<ul>
<li>But it only reflects our confidence in the estimate of the mean, <strong>not</strong> the shape of the underlying distribution!</li>
<li><strong>The standard error is less informative about our distribution as the sampling distribution deviates more from a normal distribution</strong></li>
</ul></li>
</ul>
</div>
</section>
<section id="standard-error-and-hypothesis-testing-1" class="level2">
<h2 class="anchored" data-anchor-id="standard-error-and-hypothesis-testing-1">Standard error and hypothesis testing 1</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Hypothesis test statistics">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Hypothesis test statistics
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Test statistic <span class="math inline">\(t\)</span> is a point on the distribution representing a <em>significance threshold</em></li>
</ul>
<p><span class="math display">\[ t = \frac{Z}{s} = \frac{Z}{\sigma/\sqrt{n}} \]</span></p>
<ul>
<li><span class="math inline">\(Z\)</span> is some function of the data (difference between estimate and true value); <span class="math inline">\(s\)</span> is standard error of the mean</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-empty-content callout-titled" title="This is true for many hypothesis test methods">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>This is true for many hypothesis test methods
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="notes">
<ul>
<li>In most statistical hypothesis tests, we define a test statistic denoting a significance threshold
<ul>
<li>Often, if the calculated value for our sample lies within that test statistic, we accept the null hypothesis</li>
</ul></li>
<li>The statistic is typically defined as <span class="math inline">\(t = \frac{Z}{s}\)</span> where <span class="math inline">\(t\)</span> is the test statistic value, <span class="math inline">\(Z\)</span> is some quantity calculated from the data, and <span class="math inline">\(s\)</span> is the standard error of the mean, <span class="math inline">\(\sigma/{\sqrt{n}}\)</span></li>
</ul>
</div>
</section>
<section id="standard-error-and-hypothesis-testing-2" class="level2">
<h2 class="anchored" data-anchor-id="standard-error-and-hypothesis-testing-2">Standard error and hypothesis testing 2</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="One-sample $t$-test">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>One-sample <span class="math inline">\(t\)</span>-test
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[ t = \frac{Z}{s} = \frac{\bar{X} - \mu}{\hat{\sigma}/{\sqrt{n}}} = \frac{\bar{X} - \mu}{s(\bar{X})} \]</span></p>
<ul>
<li><span class="math inline">\(\bar{X}\)</span> is the sample mean; <span class="math inline">\(\mu\)</span> is the hypothesised population mean (being tested)</li>
<li><span class="math inline">\(\hat{\sigma}\)</span> is the sample standard deviation; <span class="math inline">\(n\)</span> is the sample size; <span class="math inline">\(s(\bar{X})\)</span> is the standard error of the mean</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Wald test">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Wald test
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[ \sqrt{W} = \frac{Z}{s} = \frac{\hat{\theta} - \theta_0}{s(\hat{\theta})} \]</span></p>
<ul>
<li><span class="math inline">\(\hat{\theta}\)</span> is the estimated maximising argument of the likelihood function; <span class="math inline">\(\theta_0\)</span> is the hypothesised value under test</li>
<li><span class="math inline">\(s(\hat{\theta})\)</span> is the standard error of <span class="math inline">\(\hat{\theta}\)</span></li>
</ul>
</div>
</div>
<div class="notes">
<ul>
<li><p>You may have come across the t-test before?</p></li>
<li><p>The t-statistic <span class="math inline">\(t\)</span> is calculated as <span class="math inline">\(Z/s\)</span> where <span class="math inline">\(Z\)</span> is the difference between the estimated mean and the hypothesised population mean (the thing you are testing for equality to), and <span class="math inline">\(s\)</span> is the standard error of the estimate of the mean.</p></li>
<li><p>You’ll likely <em>not</em> have come across the Wald test?</p></li>
<li><p>But it follows the same form</p>
<ul>
<li>Here <span class="math inline">\(\hat{\theta} - \theta_0\)</span> is the difference between an estimated most likely value and the hypothesised most likely value</li>
<li><span class="math inline">\(s\)</span> is the standard error of the estimate of the most likely value</li>
</ul></li>
<li><p>The standard error is influenced by (gets smaller with) the square root of sample size in both cases</p></li>
</ul>
</div>
</section>
<section id="standard-error-and-hypothesis-testing-3" class="level2">
<h2 class="anchored" data-anchor-id="standard-error-and-hypothesis-testing-3">Standard error and hypothesis testing 3</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Hypothesis test statistics">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Hypothesis test statistics
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Test statistic <span class="math inline">\(t\)</span> is a point on the distribution representing a <em>significance threshold</em></li>
</ul>
<p><span class="math display">\[ t = \frac{Z}{s} = \frac{Z}{\sigma/\sqrt{n}} \]</span></p>
<ul>
<li><span class="math inline">\(Z\)</span> is some function of the data (difference between estimate and true value); <span class="math inline">\(s\)</span> is standard error of the mean</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-empty-content callout-titled" title="What happens if we hold $Z$ and $\sigma$ constant and vary sample size?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>What happens if we hold <span class="math inline">\(Z\)</span> and <span class="math inline">\(\sigma\)</span> constant and vary sample size?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="notes">
<ul>
<li><p>So what happens if we hold <span class="math inline">\(Z\)</span> and <span class="math inline">\(\sigma\)</span> constant (i.e.&nbsp;we estimate the same difference from our hypothesised mean value), but vary the number of samples?</p></li>
<li><p>So as <span class="math inline">\(n\)</span> increases, the standard error <span class="math inline">\(\sigma/{\sqrt{n}}\)</span> gets smaller</p></li>
<li><p><span class="math inline">\(Z\)</span> however remains the same size, so the <span class="math inline">\(t\)</span> statistic gets larger (for the same value of <span class="math inline">\(Z\)</span>).</p></li>
</ul>
</div>
</section>
<section id="sample-size-and-hypothesis-testing-1" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-and-hypothesis-testing-1">Sample size and hypothesis testing 1</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="We reject the null hypothesis when $t > $t_\textrm{crit}$">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>We reject the null hypothesis when $t &gt; <span class="math inline">\(t_\textrm{crit}\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Suppose we set <span class="math inline">\(t_\textrm{crit} = 2\)</span> (and <span class="math inline">\(\sigma=1\)</span>, <span class="math inline">\(n=3\)</span>)</li>
<li>We can calculate <span class="math inline">\(t = \frac{Z}{s} = \frac{Z}{\sigma/\sqrt{n}}\)</span> for any value of <span class="math inline">\(Z\)</span></li>
</ul>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming sd=1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># z is the difference between the estimate and the hypothesised mean</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The t-values correspond to: (t1, 3), (t2, 5), (t3, 7), (t4, 10), (t5, 15)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">z=</span><span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">2</span>, <span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t1=</span>z<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t2=</span>z<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t3=</span>z<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">7</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t4=</span>z<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">10</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t5=</span>z<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">15</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(t1, t2, t3, t4, t5),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"sample_size"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"t_statistic"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfm <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_size<span class="sc">==</span><span class="st">"t1"</span>), <span class="fu">aes</span>(<span class="at">x=</span>z, <span class="at">y=</span>t_statistic, <span class="at">color=</span>sample_size)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin=</span><span class="dv">0</span>, <span class="at">xmax=</span><span class="dv">2</span>, <span class="at">ymin=</span><span class="dv">0</span>, <span class="at">ymax=</span><span class="dv">2</span>, <span class="at">fill=</span><span class="st">"orange"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x=</span><span class="dv">0</span>, <span class="at">xend=</span><span class="dv">2</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">yend=</span><span class="dv">2</span>, <span class="at">colour=</span><span class="st">"orange"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>, <span class="at">linewidth=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.75</span>, <span class="at">y=</span><span class="fl">2.15</span>, <span class="at">label=</span><span class="st">"t-critical=2"</span>, <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.5</span>, <span class="at">y=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"ACCEPT NULL HYPOTHESIS"</span>, <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.5</span>, <span class="at">y=</span><span class="dv">3</span>, <span class="at">label=</span><span class="st">"REJECT NULL HYPOTHESIS"</span>, <span class="at">color=</span><span class="st">"purple"</span>) <span class="sc">+</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Z = (estimate - hypothesised mean)"</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"calculated t value"</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"n=3"</span>, <span class="st">"n=5"</span>, <span class="st">"n=7"</span>, <span class="st">"n=10"</span>, <span class="st">"n=15"</span>)) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06-standard_errors_files/figure-html/t_vs_n_one_sample_size-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<ul>
<li><p>So suppose we set a confidence interval that gives us a test statistic: t-critical=2</p>
<ul>
<li>So any difference <span class="math inline">\(Z\)</span> between our estimated mean and the test value giving a value of t less than 2 is “not significant” and we accept the null hypothesis</li>
<li>Any difference <span class="math inline">\(Z\)</span> between our estimated mean and the test value giving a value of t greater than 2 is “significant” and we reject the null hypothesis</li>
</ul></li>
<li><p>The plot now shows the relationship between <span class="math inline">\(Z\)</span>, our measured difference from the hypothesised mean, and the value of the resulting test statistic <span class="math inline">\(t\)</span> for a sample size of three measurements</p></li>
<li><p>With three measurements, we need a Z value of about 1.15 or greater for the line to cross the critical value and for us to reject the null hypothesis</p>
<ul>
<li>If we saw a Z value of less than 1.15, we would accept the null hypothesis</li>
<li>If we saw a Z value of greater than 1.15, we would reject the null hypothesis</li>
</ul></li>
</ul>
</div>
</section>
<section id="sample-size-and-hypothesis-testing-2" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-and-hypothesis-testing-2">Sample size and hypothesis testing 2</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="The difference ($Z$) we need to see to reject the null varies with sample size">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>The difference (<span class="math inline">\(Z\)</span>) we need to see to reject the null varies with sample size
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Set <span class="math inline">\(t_\textrm{crit} = 2\)</span></li>
<li><span class="math inline">\(n=3 \implies Z_\textrm{crit} \approx 1.15\)</span>; <span class="math inline">\(n=15 \implies Z_\textrm{crit} \approx 0.5\)</span></li>
</ul>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the other curves</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x=</span>z, <span class="at">y=</span>t_statistic, <span class="at">color=</span>sample_size)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin=</span><span class="dv">0</span>, <span class="at">xmax=</span><span class="dv">2</span>, <span class="at">ymin=</span><span class="dv">0</span>, <span class="at">ymax=</span><span class="dv">2</span>, <span class="at">fill=</span><span class="st">"orange"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x=</span><span class="dv">0</span>, <span class="at">xend=</span><span class="dv">2</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">yend=</span><span class="dv">2</span>, <span class="at">colour=</span><span class="st">"orange"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>, <span class="at">linewidth=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.75</span>, <span class="at">y=</span><span class="fl">2.15</span>, <span class="at">label=</span><span class="st">"t-critical=2"</span>, <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.5</span>, <span class="at">y=</span><span class="dv">1</span>, <span class="at">label=</span><span class="st">"ACCEPT NULL HYPOTHESIS"</span>, <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">1.5</span>, <span class="at">y=</span><span class="dv">3</span>, <span class="at">label=</span><span class="st">"REJECT NULL HYPOTHESIS"</span>, <span class="at">color=</span><span class="st">"purple"</span>) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Z = (estimate - hypothesised mean)"</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"calculated t value"</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"n=3"</span>, <span class="st">"n=5"</span>, <span class="st">"n=7"</span>, <span class="st">"n=10"</span>, <span class="st">"n=15"</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06-standard_errors_files/figure-html/t_vs_n-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<ul>
<li><p>The plot shows the relationship between <span class="math inline">\(Z\)</span>, our measured difference from the hypothesised mean, and the value of the resulting test statistic <span class="math inline">\(t\)</span> for a range of sample sizes from 3 to 15 measurements</p></li>
<li><p>With three measurements, we need a Z value of about 1.15 or greater for the line to cross the critical value and for us to reject the null hypothesis</p></li>
<li><p>With 15 measurements, we only need a Z value of about 0.5 to reject the null hypothesis</p>
<ul>
<li>Five times the sample size means we reject the null hypothesis at about half the size of measured difference</li>
</ul></li>
<li><p><strong>Changing the sample size changes how sensitive our hypothesis test is</strong></p></li>
</ul>
</div>
</section>
<section id="statistical-significance-and-effect-size" class="level2">
<h2 class="anchored" data-anchor-id="statistical-significance-and-effect-size">Statistical significance and effect size</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Statistical significance is not the point">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Statistical significance is not the point
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We can meet any statistical significance threshold for a difference by sufficiently increasing the sample size</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Statistical significance is not the same as practical importance">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Statistical significance is not the same as practical importance
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Suppose a treatment increased earnings by £10 per year with a standard error of £2 (average salary £25,000).
<ul>
<li>This would be statistically, but not practically, significant</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="What matters is _effect size_">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>What matters is <em>effect size</em>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In all our experiments we should be concerned <em>not</em> with “statistical significance,” but with <strong>how likely it is that, if there is a meaningful effect of the treatment, our experiment will be able to detect it?</strong></p>
<ul>
<li>We need to be concerned with <em>statistical power</em></li>
</ul>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/sipbs-compbiol\.github\.io\/MP968-Workshop_Experimental_Design_Slides\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>